{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto px-6 py-12">
    <div class="text-center mb-10">
        <div class="text-xs font-mono text-zinc-500 mb-4">// RECOVER</div>
        <h1 class="text-3xl font-bold mb-4 text-white">Reconstruct Seed Phrase</h1>
        <p class="text-zinc-400">
            Enter any 2 of the 3 shards. Client-side only.
        </p>
    </div>

    <div class="border-gradient rounded-xl p-8 space-y-6">

        <!-- Offline Mode Banner -->
        <div id="connection-status" class="rounded-lg transition-all duration-300">
            <!-- Filled by JavaScript -->
        </div>

        <div>
            <label class="block text-xs font-mono text-zinc-500 mb-2">SHARD 1</label>
            <input type="text" id="shard-1"
                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 font-mono text-sm text-white focus:border-accent outline-none transition"
                placeholder="801...">
        </div>

        <div>
            <label class="block text-xs font-mono text-zinc-500 mb-2">SHARD 2</label>
            <input type="text" id="shard-2"
                class="w-full bg-zinc-900 border border-zinc-700 rounded-lg p-3 font-mono text-sm text-white focus:border-accent outline-none transition"
                placeholder="802...">
        </div>

        <button onclick="recoverSeed()"
            class="w-full py-3 bg-accent hover:bg-emerald-400 text-black font-semibold rounded-lg transition">
            Reconstruct Seed Phrase
        </button>

        <div id="result-container" class="hidden mt-8 pt-8 border-t border-zinc-800">
            <div class="flex items-center gap-2 mb-4">
                <span class="text-xs font-mono text-accent">// RECOVERED</span>
                <span class="text-xs px-2 py-0.5 bg-accent/20 text-accent rounded">SUCCESS</span>
            </div>
            <div class="bg-zinc-900 p-4 rounded-lg border border-zinc-700">
                <p id="recovered-seed" class="font-mono text-accent break-words"></p>
            </div>
            <p class="text-xs text-red-500 mt-4">
                Warning: Move your funds immediately. This seed has been exposed.
            </p>
        </div>
    </div>
</div>

<script>
    function updateConnectionStatus() {
        const statusEl = document.getElementById('connection-status');

        if (navigator.onLine) {
            statusEl.innerHTML = `
                <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4">
                    <div class="flex items-center gap-3">
                        <div class="text-yellow-400 font-mono text-xs">ONLINE</div>
                        <div class="text-sm text-yellow-300/70">Disconnect internet for maximum security.</div>
                    </div>
                </div>
            `;
        } else {
            statusEl.innerHTML = `
                <div class="bg-accent/10 border border-accent/30 rounded-lg p-4">
                    <div class="flex items-center gap-3">
                        <div class="text-accent font-mono text-xs">OFFLINE</div>
                        <div class="text-sm text-accent/70">Maximum security. Recovery is 100% local.</div>
                    </div>
                </div>
            `;
        }
    }

    window.addEventListener('online', updateConnectionStatus);
    window.addEventListener('offline', updateConnectionStatus);
    document.addEventListener('DOMContentLoaded', updateConnectionStatus);

    function recoverSeed() {
        const s1 = document.getElementById('shard-1').value.trim();
        const s2 = document.getElementById('shard-2').value.trim();

        if (!s1 || !s2) {
            alert("Enter two shards.");
            return;
        }

        try {
            const hex = secrets.combine([s1, s2]);
            const seed = secrets.hex2str(hex);
            document.getElementById('recovered-seed').innerText = seed;
            document.getElementById('result-container').classList.remove('hidden');
        } catch (e) {
            console.error(e);
            alert("Reconstruction failed. Invalid shards.");
        }
    }
</script>
{% endblock %}